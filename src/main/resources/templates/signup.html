<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Sign-Up page WonderBoot</title>
    <link rel="stylesheet" th:href="@{/css/login_signup_styles.css}">
    <!-- Incluir el CSS de Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />

    <!-- Incluir jQuery (Select2 depende de jQuery) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Incluir el JS de Select2 -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
</head>
<body>
<div class="login-container">
    <!-- Display error message if credentials are incorrect -->
    <div th:if="${param.error}" class="error-message">The Username or Password are incorrect</div>
    <!-- Login form -->
    <h2>REGISTRATION</h2>
    <form th:action="@{/signup}" th:object="${registrationUser}" method="post">
        <input id="username" type="text" th:field="*{username}" placeholder="Username" required />
        <input id="name" type="text" th:field="*{name}" placeholder="Name" required />
        <input id="surname" type="text" th:field="*{surname}" placeholder="Surname" required />
        <!--  Connection to the Location API
        <select name="country" id="country" th:field="*{country.code}">
            <option th:each="country : ${countries}" th:value="${country.code}" th:text="${country.name}"></option>
        </select>-->
        <div th:classappend="${#fields.hasErrors('country')} ? 'is-invalid'">
            <label th:for="${#ids.next('country.code')}">Country</label>
            <div>
                <select class="country-dropdown" th:field="*{country.code}" th:classappend="${#fields.hasErrors('country')} ? 'is-invalid'" placeholder="Country">
                    <option
                            th:if="*{country.code}"
                            th:value="*{country.code}"
                            th:text="*{country.name}"
                    ></option>
                </select>
                <span th:if="${#fields.hasErrors('country')}" th:errors="*{country}" class="invalid-feedback"></span>
            </div>
        </div>

        <input type="email" th:field="*{email}" id="email" placeholder="Email" required />
        <input id="password" type="password" th:field="*{password}" placeholder="Password" required />
        <input id="repeatPassword" type="password" th:field="*{repeatPassword}" placeholder="Repeat Password" required />
        <input type="date" th:field="*{dateOfBirth}" id="date">
        <input type="submit" value="Register">
        <a th:href="@{/login}">Cancel</a>
    </form>
</div>
</body>
<script>
    $(document).ready(function() {
        $('.country-dropdown').select2({
        theme: 'bootstrap',
            minimumInputLength: 1,
            ajax: {
            url: "http://localhost:8081/api/countries",
                dataType: 'json',
                delay: 250,
                processResults(data) {
                return {
                    results: data.map(country => ({
                        id: country.code,
                        text: country.name
                    }))
                };
            }
        },
        templateResult: formatDropdownItem,
            templateSelection: formatDropdownItem
    });

    function formatDropdownItem(data) {
        if(!data.id) {
            return data.text;
        }

        const $flag = $('<img class="country-flag">').attr({
            src: `${flagsBaseUrl}/${data.id.toLowerCase()}.svg`,
            alt: data.text,
            title: data.text
        });

        return $('<span></span>').append($flag, data.text);
    }
    });
</script>
</html>